const { GoogleGenerativeAI } = require("@google/generative-ai");
const fs = require('fs');

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

async function run() {
  const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
  const csvData = fs.readFileSync('news.csv', 'utf8');

  const prompt = `
    以下のニュースリスト（CSV形式）を読み取り、英語は日本語に翻訳して使用する。
    1、●●　●●で囲んだ媒体ごとに見出し記事を抽出する。媒体はyahoo、ロイター、時事、日経、BBC、ブルームバーグ、WSJ、NYタイムス
    2、各媒体の見出し記事を総合的に勘案（各媒体の扱いの大きさ、関連記事の多さなど）して、重要ニュースを10個厳選する。
    3、「重要ニュース」を10個を厳選して【見出し】（媒体名）yyyy/mm/dd を記述する。
    重要ニュースは複数媒体が報じるはずなので、報じた媒体を媒体名として、で区切って羅列する。3社以上は「等」と入れたうえで省略する。
    
    4、「国内ニュース」5個を厳選して【見出し】を並べてください。3社以上は「等」と入れたうえで省略する。
    5、「海外ニュース」5個を厳選して【見出し】を並べてください。3社以上は「等」と入れたうえで省略する。
    6，「その他ニュース」としてエンタメ、スポーツ、社会などのニュースの中から厳選して2個から5個を並べてください。重要性の低いニュースは提示しない。
    各【見出し】の後ろに（）で囲んで媒体名を表記すること。
    7、（）で囲んだ中に媒体名を入れる。そのの後に年月日をyyyy/mm/ddの形式で付記すること。
    8、各媒体ごとに主要な記事を5つずつ提示していく。見出しは各媒体の見出しに基づくが、英語の場合は日本語に翻訳する。複数社が報じていないユニークな記事を必ず含ませる。
    （）で囲んだ中に媒体名を入れる。その後に年月日をyyyy/mm/ddの形式で付記すること。
    9、はい、承知いたしました。以下にニュースリストを分析し、厳選したニュースとまとめを提示します。という文言は不要。
    10、最後に総合的なまとめを200字以内の文章で表す。最終チェック、全ての出力は日本語で行うこと。
    11、以下に表記例を示す。

    表記の様式の例
    ●重要ニュース●
    1. ●●●●●●（ロイター、ブルームバーグ、BBC等）2026/02/20
    2. ●●●●●●（ロイター、ブルームバーグ、BBC等）2026/02/20
    3. ●●●●●●（ロイター、ブルームバーグ、BBC等）2026/02/20
    4. ●●●●●●（ロイター、ブルームバーグ、BBC等）2026/02/20
    5. ●●●●●●（yahoo、ブルームバーグ）2026/02/20
    6. ●●●●●● 注意点は（ロイター、ブルームバーグ、BBC等）2026/02/20
    7. ●●●●●●（ロイター、ブルームバーグ、BBC）2026/02/20
    8. ●●●●●●（日経、ブルームバーグ）2026/02/20
    9. ●●●●●●（yahoo、ブルームバーグ、BBC）2026/02/20
   10. ●●●●●●（日経、NYタイムス、BBC）2026/02/20

    ●経済ニュース●
    1.○○○○●（ブルームバーグ、BBC）2026/02/20
    2.○○○○●（日経、ヤフー）2026/02/20
    3.○○○○●（日経、時事、ブルームバーグ、BBC）2026/02/20
    4.○○○○●（日経、yahoo、時事）2026/02/20
    5.○○○○●（日経、ブルームバーグ、BBC）2026/02/20
    6. ●●●●●● 注意点は（ロイター、ブルームバーグ、BBC等）2026/02/20
    7. ●●●●●●（ロイター、ブルームバーグ、BBC）2026/02/20
    8. ●●●●●●（日経、ブルームバーグ）2026/02/20
    9. ●●●●●●（yahoo、ブルームバーグ、BBC）2026/02/20
   10. ●●●●●●（日経、NYタイムス、BBC）2026/02/20
    ●国内ニュース●
    1.○○○○●（ブルームバーグ、BBC）2026/02/20
    2.○○○○●（日経、ヤフー）2026/02/20
    3.○○○○●（日経、時事、ブルームバーグ、BBC）2026/02/20
    4.○○○○●（日経、yahoo、時事）2026/02/20
    5.○○○○●（日経、ブルームバーグ、BBC）2026/02/20
    ●海外ニュース●
    1.○○○○●（ブルームバーグ、BBC）2026/02/20
    2.○○○○●（日経、ヤフー）2026/02/20
    3.○○○○●（日経、時事、ブルームバーグ、BBC）2026/02/20
    4.○○○○●（日経、yahoo、時事）2026/02/20
    5.○○○○●（日経、ブルームバーグ、BBC）2026/02/20
    ●その他ニュース●
    1.○○○○●（ブルームバーグ、BBC）2026/02/20
    2.○○○○●（日経、ヤフー）2026/02/20
    3.○○○○●（日経、時事、ブルームバーグ、BBC）2026/02/20
    4.○○○○●（日経、yahoo、時事）2026/02/20
    5.○○○○●（日経、ブルームバーグ、BBC）2026/02/20
    
    ●ロイター●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●ブルームバーグ●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●BBC●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●日経●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●時事●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●WSJ●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●NYタイムズ●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●yahoo●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●AI関連●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●コメント●
    国内では○○、海外では●●●、○○が話題となりました。○○問題が各媒体で取り上げられました。
    AI関連の○○で○○株が●●しました。株式市場では○○○●。債券市場では○○。国内株式市場では●●●。
　　スポーツでは○○イベントの○○が金メダルを獲得しました。○○で視察事件が発生しました。
  
    リスト：
    ${csvData}
  `;

  const result = await model.generateContent(prompt);
  fs.writeFileSync('summary.txt', result.response.text());
}

run();
