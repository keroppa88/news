const { GoogleGenerativeAI } = require("@google/generative-ai");
const fs = require('fs');

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

async function run() {
  const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
  const csvData = fs.readFileSync('news.csv', 'utf8');

  const prompt = `
    以下のニュースリスト（CSV形式）を読み取り、英語は日本語に翻訳して使用する。
    1、●●　●●で囲んだ媒体ごとに見出し記事を抽出する。媒体はyahoo、ロイター、時事、日経、BBC、ブルームバーグ、WSJ、NYタイムス
    2、各媒体の見出し記事を総合的に勘案（各媒体の扱いの大きさ、関連記事の多さなど）して、重要ニュースを10個厳選する。
    3、「重要ニュース」を10個を厳選して【見出し】（媒体名）yyyy/mm/dd を記述する。
    重要ニュースは複数媒体が報じるはずなので、報じた媒体を媒体名として、で区切って羅列する。3社以上は「等」と入れたうえで省略する。
    
    4、「国内ニュース」5個を厳選して【見出し】を並べてください。
    5、「海外ニュース」5個を厳選して【見出し】を並べてください。
    6，「その他ニュース」としてエンタメ、スポーツ、社会などのニュースの中から厳選して2個から5個を並べてください。重要性の低いニュースは提示しない。
    各【見出し】の後ろに（）で囲んで媒体名を表記すること。
    7、（）で囲んだ中に媒体名を入れる。そのの後に年月日をyyyy/mm/ddの形式で付記すること。
    8、各媒体ごとに主要な記事を5つずつ提示していく。見出しは各媒体の見出しに基づくが、英語の場合は日本語に翻訳する。複数社が報じていないユニークな記事を必ず含ませる。
    （）で囲んだ中に媒体名を入れる。その後に年月日をyyyy/mm/ddの形式で付記すること。
    9，はい、承知いたしました。以下にニュースリストを分析し、厳選したニュースとまとめを提示します。という文言は不要。
    10、以下に表記例を示す。

 
    ●重要ニュース●
    1. トランプ関税 米最高裁が違法判決（ロイター、ブルームバーグ、BBC等）2026/02/20
    2. 露報道官「日露関係ゼロに低下」（ロイター、ブルームバーグ、BBC等）2026/02/20
    3. 高市首相○○（ロイター、ブルームバーグ、BBC等）2026/02/20
    4. 図書館刺傷 男を取り押さえた70代（ロイター、ブルームバーグ、BBC等）2026/02/20
    5. 手術で体内に袋忘れる 痛みで発覚（yahoo、ブルームバーグ）2026/02/20
    6. 症状なくてもインフル? 注意点は（ロイター、ブルームバーグ、BBC等）2026/02/20
    7. エヌビディア倒産説　声明（ロイター、ブルームバーグ、BBC）2026/02/20
    8. 演技後のしぐさ 中井亜美が解説（日経、ブルームバーグ）2026/02/20
    9. 政府 122兆円の予算案を国会提出（yahoo、ブルームバーグ、BBC）2026/02/20
    10. 幼稚園の1クラス 原則30人以下に（日経、NYタイムス、BBC）2026/02/20

    ●国内ニュース●
    1.○○○○●（ブルームバーグ、BBC）2026/02/20
    2.○○○○●（日経、ヤフー）2026/02/20
    3.○○○○●（日経、時事、ブルームバーグ、BBC）2026/02/20
    4.○○○○●（日経、yahoo、時事）2026/02/20
    5.○○○○●（日経、ブルームバーグ、BBC）2026/02/20
    ●海外ニュース●
    1.○○○○●（ブルームバーグ、BBC）2026/02/20
    2.○○○○●（日経、ヤフー）2026/02/20
    3.○○○○●（日経、時事、ブルームバーグ、BBC）2026/02/20
    4.○○○○●（日経、yahoo、時事）2026/02/20
    5.○○○○●（日経、ブルームバーグ、BBC）2026/02/20
    ●その他ニュース●
    1.○○○○●（ブルームバーグ、BBC）2026/02/20
    2.○○○○●（日経、ヤフー）2026/02/20
    3.○○○○●（日経、時事、ブルームバーグ、BBC）2026/02/20
    4.○○○○●（日経、yahoo、時事）2026/02/20
    5.○○○○●（日経、ブルームバーグ、BBC）2026/02/20

    ●ロイター●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●ブルームバーグ●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    ●BBC●
    1.○○○○●　2026/02/20
    2.○○○○●　2026/02/20
    3.○○○○●　2026/02/20
    4.○○○○●　2026/02/20
    5.○○○○●　2026/02/20
    以下省略
    
    リスト：
    ${csvData}
  `;

  const result = await model.generateContent(prompt);
  fs.writeFileSync('summary.txt', result.response.text());
}

run();
